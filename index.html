<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Willkommen beim Gewinnspiel!</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(180deg, #fafafa 0%, #cfcfcf 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
            text-align: center;
        }
        .container {
            max-width: 600px;
            width: 100%;
            padding: 30px;
            background-color: #fafafa;
            border-radius: 10px;
            box-shadow: 0px 0px 20px rgba(0,0,0,0.1);
        }
        #welcomeMessage, #codeForm, #emailForm, #thankyouMessage {
            display: none;
        }
        .legalNotes {
            font-size: 0.7em;
            text-align: justify;
        }
        .lotteryInfo {
            font-size: 0.9em;
            text-align: justify;
        }
        .bold {
            font-size: 1.2em;
        }
        input[type="email"], button[type="submit"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1em;
        }
        button[type="submit"] {
            background-color: #8fd3f4;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        img {
            width: 300px;
            display: block;
            margin: 0 auto;
        }
        .divider {
            border-top: 1px solid #ccc;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://upload.wikimedia.org/wikipedia/commons/4/4e/Universität_Leipzig_logo.svg" alt="Universität Leipzig">
        <div id="welcomeMessage">
            <h1>Willkommen beim Gewinnspiel!</h1>
        </div>
        <div id="codeForm">
            <h2>Code eingeben</h2>
            <form onsubmit="handleCodeSubmission(); return false;">
                <p>Bitte trage hier eine vierstellige Zahl zwischen 0000 und 9999 ein:</p>
                <input type="number" id="codeInput" name="codeInput" min="0" max="9999" required placeholder="Dein Code" />
                <button type="submit">Weiter</button>
                <p class="legalNotes">
                    Du gewinnst, wenn deine Nummer mit den ersten vier Ziffern der öffentlich einsehbaren Zusatzlotterie "Spiel 77" vom Samstag den 05. August 2023 übereinstimmen. Sollte es unter allen Teilnehmenden keinen Treffer geben, gewinnt die Losnummer, die numerisch am nächsten dran ist. <br><br> Die Teilnahme am Gewinnspiel ist kostenlos, freiwillig, unverbindlich und kann jederzeit widerrufen werden.
                </p>
            </form>
        </div>
        <div id="emailForm" style="display: none;">
            <h2>Vielen Dank für Deine Teilnahme!</h2>
            <p class="lotteryInfo">Deine ausgewählte Losnummer lautet: <span id="lotteryNumber"></span></p>
            <p class="lotteryInfo">Dein einmaliger Teilnahme-Code lautet: <span id="participationCode"></span></p>
            <form onsubmit="handleEmailSubmission(); return false;">
                <input type="email" id="emailInput" name="emailInput" required placeholder="Deine E-Mail Adresse" />
                <button type="submit">Absenden</button>
            </form>
        </div>
        <div id="thankyouMessage" style="display: none;">
            <h2>Vielen Dank für Deine Teilnahme!</h2>
            <p>Das Formular wurde erfolgreich übermittelt.</p>
        </div>
    </div>

    <script>
        function generateRandomCode(length) {
            var result = '';
            var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            var charactersLength = characters.length;
            for (var i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        }
        function generateRandomNum(length) {
            var result = '';
            var numbers = '0123456789';
            var numbersLength = numbers.length;
            for (var i = 0; i < length; i++) {
                result += numbers.charAt(Math.floor(Math.random() * numbersLength));
            }
            return result;
        }

        function handleCodeSubmission() {
            var codeInput = document.getElementById('codeInput').value;
            var code = parseInt(codeInput);
            if (isNaN(code) || code < 0 || code > 9999) {
                alert("Bitte gib eine gültige vierstellige Zahl zwischen 0000 und 9999 ein.");
                return;
            }
            var num = generateRandomNum(4);
            var participationCode = generateRandomCode(10);

            document.getElementById('lotteryNumber').innerText = num;
            document.getElementById('participationCode').innerText = participationCode;

            document.getElementById('codeForm').style.display = "none";
            document.getElementById('emailForm').style.display = "block";
        }

        function handleEmailSubmission() {
            var email = document.getElementById('emailInput').value;
            var lotteryNumber = document.getElementById('lotteryNumber').innerText;
            var participationCode = document.getElementById('participationCode').innerText;

            // Validierungen für Email-Adresse können hier durchgeführt werden

            var formData = new FormData();
            formData.append('email', email);
            formData.append('lotteryNumber', lotteryNumber);
            formData.append('participationCode', participationCode);

            fetch('https://formspree.io/f/mdornqzl', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
                .then(function (response) {
                    if (response.ok) {
                        document.getElementById('emailForm').style.display = "none";
                        document.getElementById('thankyouMessage').style.display = "block";
                    } else {
                        alert("Ein Fehler ist aufgetreten. Bitte versuche es später erneut.");
                    }
                })
                .catch(function (error) {
                    alert("Ein Fehler ist aufgetreten. Bitte versuche es später erneut.");
                    console.error(error);
                });
        }

        // Zeige die Willkommensnachricht und das Formular, wenn das Dokument geladen ist
        document.addEventListener('DOMContentLoaded', (event) => {
            document.getElementById('welcomeMessage').style.display = "block";
            document.getElementById('codeForm').style.display = "block";
        });
    </script>
</body>
</html>
